<!DOCTYPE html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>登录</title>
	<script src="js/jquery-latest.js"></script>
	<script type="text/javascript" src="js/layer_mobile/layer.js"></script>
</head>

<body>

	<input type="text" style="text-align: center;" name="logname" id="logname" value="" placeholder="账户" /><br/>
	<input type="password" style="text-align: center;" name="logpass" id="logpass" value="" placeholder="密码" /><br/>
	<input id="login_button" type="button" data-role="button" data-theme="b" value="登录">
	<input id="register_button" type="button" data-role="button" data-theme="b" onclick="window.location.href='register.html'" value="注册">
	<script>
		$('#login_button').click(function() { //点击登录按钮事件，执行登录验证
			var logname = $('#logname').val();
			var logpass = $('#logpass').val();

			if(logname == "") {
				layer.open({
					content: '抱歉，用户名不能为空',
					btn: '我知道了'
				});
				$("[name='logname']").focus();
				return;
			}

			if(logpass == "") {
				layer.open({
					content: '抱歉，密码不能为空',
					btn: '我知道了'
				});
				$("[name='logpass']").focus();
				return;
			}

			$.ajax({
				url: "http://127.0.0.1:8000/jwt_login/",
				type: "post",
				dataType: "json",
				data: {
					"username": logname,
					"password": logpass
				}, //数据为登录名和登录密码

				beforeSend: function() {
					document.getElementById("login_button").value = "登录中";
				},

				success: function(data) {
					//alert(data.token);
					sessionStorage.setItem("user_id", data.id);
					sessionStorage.setItem("username", data.username);
					sessionStorage.setItem("token", 'JWT ' + data.token);
					if(data.is_staff == false){
						alert("未通过审核")
						window.location.href='member/index.html';
						return;
					}
					window.location.href='member/index.html';
				},

				error: function(jqXHR) {
					var json_responseText = JSON.parse(jqXHR.responseText);
					if(json_responseText.username_error_field != null) {
						alert(json_responseText.username_error_field);
					}
					if(json_responseText.password_error_field != null) {
						alert(json_responseText.password_error_field);
					}
					document.getElementById("login_button").value = "登录";
				}
				/*
					layer.open({
						content: '消息：' + data.msg,
						skin: 'msg',
						time: 2 //2秒后自动关闭
					});
					if(data.state == true) {
						sessionStorage.setItem("loginname", logname);
						setTimeout(function() {
							window.location.href = 'manage-info.html';
						}, 2000);
						//document.body.scrollTop=document.body.scrollHeight;
					}
					*/
				/*
					if(date.state == "false"){
						alert(data.msg);
					}
					/*
					if(data.state==true){
						alert(data.msg);
					}
					
					/*
					var obj = JSON.parse(data);
					if(obj.state==false){
						alert(obj.msg);
					}
					/*
					if(data == false) {
												//$("[name='logpass']").val("");
						//$("[name='logpass']").attr('placeholder', "密码错误");
						//$('#logbot').val("登录");
					} else {
						window.location.href = 'login.html';
					}
				*/
			});
		});
	</script>
</body>