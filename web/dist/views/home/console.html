<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<title>layuiAdmin 控制台主页一</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../../layuiadmin/style/admin.css" media="all">
		<script type="text/javascript" charset="utf8" src="../../layuiadmin/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
	</head>

	<body>

		<div class="layui-fluid">
			<div class="layui-row layui-col-space15">
				<div class="layui-col-md8">
					<div class="layui-row layui-col-space15">
						<div class="layui-col-md6">
							<div class="layui-card">
								<div class="layui-card-header">快捷方式</div>
								<div class="layui-card-body">

									<div class="layui-carousel layadmin-carousel layadmin-shortcut">
										<div carousel-item>
											<ul class="layui-row layui-col-space10">
												<li class="layui-col-xs3">
													<a lay-href="home/homepage1.html">
														<i class="layui-icon layui-icon-console"></i>
														<cite>主页一</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="home/homepage2.html">
														<i class="layui-icon layui-icon-chart"></i>
														<cite>主页二</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="component/layer/list.html">
														<i class="layui-icon layui-icon-template-1"></i>
														<cite>弹层</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a layadmin-event="im">
														<i class="layui-icon layui-icon-chat"></i>
														<cite>聊天</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="component/progress/index.html">
														<i class="layui-icon layui-icon-find-fill"></i>
														<cite>进度条</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="app/workorder/list.html">
														<i class="layui-icon layui-icon-survey"></i>
														<cite>工单</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="user/user/list.html">
														<i class="layui-icon layui-icon-user"></i>
														<cite>用户</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/system/website.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>设置</cite>
													</a>
												</li>
											</ul>
											<ul class="layui-row layui-col-space10">
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
												<li class="layui-col-xs3">
													<a lay-href="set/user/info.html">
														<i class="layui-icon layui-icon-set"></i>
														<cite>我的资料</cite>
													</a>
												</li>
											</ul>

										</div>
									</div>

								</div>
							</div>
						</div>

						<div class="layui-col-md6">
							<div class="layui-card">
								<div class="layui-card-header">待办事项</div>
								<div class="layui-card-body">
									<div class="layui-carousel layadmin-carousel layadmin-backlog">
										<div carousel-item id="todo_list">
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="layui-col-md12">
							<div class="layui-card" style="height: 440px;">
								<div class="layui-card-header">数据概览</div>
								<div class="layui-card-body">
									<div class="layui-carousel layadmin-carousel layadmin-backlog">
										<div style="height: 360px; padding: 0 50px 0 0;" id="data_overview_01">
										</div>
									</div>
									<!--<div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-dataview">
										<div carousel-item id="LAY-index-dataview">
											<div id="data_overview_01"><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
											<div></div>
											<div></div>
										</div>
									</div>-->
								</div>
							</div>
							<div class="layui-card">
								<div class="layui-tab layui-tab-brief layadmin-latestData">
									<ul class="layui-tab-title">
										<li class="layui-this">今日热搜</li>
										<li>今日热帖</li>
									</ul>
									<div class="layui-tab-content">
										<div class="layui-tab-item layui-show">
											<table id="LAY-index-topSearch"></table>
										</div>
										<div class="layui-tab-item">
											<table id="LAY-index-topCard"></table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="layui-col-md4">
					<div class="layui-row layui-col-space15">
						<div class="layui-row layui-col-space15" id="overview_info">
						</div>

						<div class="layui-col-md12">
							<div class="layui-card">
								<div class="layui-card-header">服务器实时监控
									<button class="layui-badge layuiadmin-badge layui-btn layui-bg-blue" data-type="add" onclick="get_backend_server_info()">
                    					刷新
                					</button>
								</div>
								<div class="layui-card-body layadmin-takerates">
									<div class="layui-progress" lay-showPercent="yes">
										<h3 id="cpu_count">CPU使用率</h3>
										<div class="layui-progress-bar" id="cpu_percent" lay-percent="0%"></div>
									</div>
									<div class="layui-progress" lay-showPercent="yes">
										<h3 id="memory_total">内存占用率</h3>
										<div class="layui-progress-bar" id="memory_percent" lay-percent="0%"></div>
									</div>
									<div class="layui-progress" lay-showPercent="yes">
										<h3 id="disk_total">硬盘使用率</h3>
										<div class="layui-progress-bar" id="disk_percent" lay-percent="0%"></div>
									</div>
								</div>
							</div>
						</div>

						<div class="layui-col-md12">
							<div class="layui-card">
								<div class="layui-card-header">产品动态</div>
								<div class="layui-card-body">
									<div class="layui-carousel layadmin-carousel layadmin-news" data-autoplay="true" data-anim="fade" lay-filter="news">
										<div carousel-item>
											<div>
												<a href="http://fly.layui.com/docs/2/" target="_blank" class="layui-bg-red">layuiAdmin 快速上手文档</a>
											</div>
											<div>
												<a href="http://fly.layui.com/vipclub/list/layuiadmin/" target="_blank" class="layui-bg-green">layuiAdmin 会员讨论专区</a>
											</div>
											<div>
												<a href="http://www.layui.com/admin/#get" target="_blank" class="layui-bg-blue">获得 layui 官方后台模板系统</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="layui-col-md12">
							<div class="layui-card">
								<div class="layui-card-header">
									作者心语
									<i class="layui-icon layui-icon-tips" lay-tips="要支持的噢" lay-offset="5"></i>
								</div>
								<div class="layui-card-body layui-text layadmin-text">
									<p>一直以来，layui 秉承无偿开源的初心，虔诚致力于服务各层次前后端 Web 开发者，在商业横飞的当今时代，这一信念从未动摇。即便身单力薄，仍然重拾决心，埋头造轮，以尽可能地填补产品本身的缺口。</p>
									<p>在过去的一段的时间，我一直在寻求持久之道，已维持你眼前所见的一切。而 layuiAdmin 是我们尝试解决的手段之一。我相信真正有爱于 layui 生态的你，定然不会错过这一拥抱吧。</p>
									<p>子曰：君子不用防，小人防不住。请务必通过官网正规渠道，获得
										<a href="http://www.layui.com/admin/" target="_blank">layuiAdmin</a>！</p>
									<p>—— 贤心（
										<a href="http://www.layui.com/" target="_blank">layui.com</a>）</p>
								</div>
							</div>
						</div>

					</div>

				</div>

			</div>
		</div>

		<script src="../../layuiadmin/layui/layui.all.js?t=1"></script>
		<script src="../../layuiadmin/js/check-token.js"></script>

		<script>
			// 获取 "待办事项"
			$.ajax({
				url: "http://127.0.0.1:8000/system_setting/get_todo_list/",
				type: "get",
				headers: {
					"Authorization": "JWT " + localStorage.getItem("cache_token")
				},
				dataType: "json",
				success: function(data) {
					var i = 0;
					var str = '<ul class="layui-row layui-col-space10">';
					$.each(data, function(key, val) {
						if(key == "water_fees") {
							str += '<li class="layui-col-xs6">' +
								'<a lay-href="dormitories/water_fees/list.html" class="layadmin-backlog-body">' +
								'<h3>待缴水费宿舍</h3>' +
								'<p><cite style="color: #FF5722;">' + val + '</cite></p>' +
								'</a>' +
								'</li>';
							i++;
						}
						if(key == "electricity_fees") {
							str += '<li class="layui-col-xs6">' +
								'<a lay-href="dormitories/electricity_fees/list.html" class="layadmin-backlog-body">' +
								'<h3>待缴电费宿舍</h3>' +
								'<p><cite style="color: #FF5722;">' + val + '</cite></p>' +
								'</a>' +
								'</li>';
							i++;
						}
						if(key == "repair") {
							str += '<li class="layui-col-xs6">' +
								'<a lay-href="dormitories/repair/list.html" class="layadmin-backlog-body">' +
								'<h3>待处理报修单</h3>' +
								'<p><cite>' + val + '</cite></p>' +
								'</a>' +
								'</li>';
							i++;
						}
						if(key == "access_control_later") {
							str += '<li class="layui-col-xs6">' +
								'<a lay-href="access_control/access_control/list_later.html" class="layadmin-backlog-body">' +
								'<h3>待处理门禁晚归记录</h3>' +
								'<p><cite>' + val + '</cite></p>' +
								'</a>' +
								'</li>';
							i++;
						}
						if(key == "access_control_application") {
							str += '<li class="layui-col-xs6">' +
								'<a lay-href="access_control/abnormal_application/list.html" class="layadmin-backlog-body">' +
								'<h3>待处理门禁异常申请</h3>' +
								'<p><cite>' + val + '</cite></p>' +
								'</a>' +
								'</li>';
							i++;
						}
						if(i % 4 == 0 && i != 4) {
							str += '</ul><ul class="layui-row layui-col-space10">';
						}
					});
					str += '</ul>';
					$('#todo_list').html(str);
				},
				error: function(jqXHR) {
					layer.msg('数据加载错误，请联系管理员处理', {
						icon: 2,
						anim: 6
					});
				}
			});

			// 获取 "系统概略信息"
			$.ajax({
				url: "http://127.0.0.1:8000/system_setting/get_overview_info/",
				type: "get",
				headers: {
					"Authorization": "JWT " + localStorage.getItem("cache_token")
				},
				dataType: "json",
				success: function(data) {
					var str = "";
					$.each(data, function(key, val) {
						if(key == "student_count_active") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'可用学生人数' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'总计学生人数' +
								'<span class="layuiadmin-span-color">' + data['student_count_total'] + ' <i class="layui-inline layui-icon layui-icon-user"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
						if(key == "staff_count_active") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'可用教职工人数' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'总计教职工人数' +
								'<span class="layuiadmin-span-color">' + data['staff_count_total'] + ' <i class="layui-inline layui-icon layui-icon-group"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
						if(key == "dormitory_count_total") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'宿舍数量' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'未满宿舍数量' +
								'<span class="layuiadmin-span-color">' + data['dormitory_count_empty'] + ' <i class="layui-inline layui-icon layui-icon-tree"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
						if(key == "access_control_day") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'门禁通过人数' +
								'<span class="layui-badge layui-bg-blue layuiadmin-badge">日</span>' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'总计门禁通过人数' +
								'<span class="layuiadmin-span-color">' + data['access_control_total'] + ' <i class="layui-inline layui-icon layui-icon-template"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
						if(key == "access_control_week") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'门禁通过人数' +
								'<span class="layui-badge layui-bg-blue layuiadmin-badge">周</span>' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'总计门禁通过人数' +
								'<span class="layuiadmin-span-color">' + data['access_control_total'] + ' <i class="layui-inline layui-icon layui-icon-template"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
						if(key == "access_control_month") {
							str += '<div class="layui-col-md6">' +
								'<div class="layui-card">' +
								'<div class="layui-card-header">' +
								'门禁通过人数' +
								'<span class="layui-badge layui-bg-blue layuiadmin-badge">月</span>' +
								'</div>' +
								'<div class="layui-card-body layuiadmin-card-list">' +
								'<p class="layuiadmin-big-font">' + val + '</p>' +
								'<p>' +
								'总计门禁通过人数' +
								'<span class="layuiadmin-span-color">' + data['access_control_total'] + ' <i class="layui-inline layui-icon layui-icon-template"></i></span>' +
								'</p>' +
								'</div>' +
								'</div>' +
								'</div>';
						}
					});
					$('#overview_info').html(str);
				}
			});

			// 获取 "后端服务器信息"
			function get_backend_server_info() {
				$.ajax({
					url: "http://127.0.0.1:8000/system_setting/get_backend_server_info/",
					type: "get",
					headers: {
						"Authorization": "JWT " + localStorage.getItem("cache_token")
					},
					dataType: "json",
					success: function(data) {
						$('#cpu_count').html('CPU使用率(物理核心数：' + data.cpu_count + ')');
						$('#cpu_percent').attr('lay-percent', data.cpu_percent + '%');
						$('#memory_total').html('内存占用率(' + data.memory_used + '/' + data.memory_total + 'MB)');
						$('#memory_percent').attr('lay-percent', data.memory_percent + '%');
						$('#disk_total').html('硬盘使用率(' + data.disk_used + '/' + data.disk_total + 'GB)');
						$('#disk_percent').attr('lay-percent', data.disk_percent + '%');

						if(data.cpu_percent > 50) {
							$('#cpu_percent').attr('class', 'layui-progress-bar layui-bg-orange');
						}
						if(data.cpu_percent > 80) {
							$('#cpu_percent').attr('class', 'layui-progress-bar layui-bg-red');
						}
						if(data.memory_percent > 50) {
							$('#memory_percent').attr('class', 'layui-progress-bar layui-bg-orange');
						}
						if(data.memory_percent > 80) {
							$('#memory_percent').attr('class', 'layui-progress-bar layui-bg-red');
						}
						if(data.disk_percent > 50) {
							$('#disk_percent').attr('class', 'layui-progress-bar layui-bg-orange');
						}
						if(data.disk_percent > 80) {
							$('#disk_percent').attr('class', 'layui-progress-bar layui-bg-red');
						}
						layui.element.init();
					},
					error: function(jqXHR) {
						layer.msg('数据加载错误，请联系管理员处理', {
							icon: 2,
							anim: 6
						});
					}
				});
			}

			// 每10秒定时获取服务器内容
			get_backend_server_info();
			var ref = setInterval(function() {
				get_backend_server_info();
			}, 10000);

			layui.config({
				base: '../../layuiadmin/' //静态资源所在路径
			}).extend({
				index: 'lib/index' //主入口模块
			}).use(['index', 'console']);

			var myChart = echarts.init(document.getElementById('data_overview_01'));

			// 指定图表的配置项和数据
			var data_overview_date = [];
			var data_overview_data = [];

			$.ajax({
				url: "http://127.0.0.1:8000/system_setting/data_overview_date/",
				type: "get",
				headers: {
					"Authorization": "JWT " + localStorage.getItem("cache_token")
				},
				dataType: "json",
				async: false,
				success: function(data) {
					data_overview_date = data.date
				},
				error: function(jqXHR) {
					layer.msg('数据加载错误，请联系管理员处理', {
						icon: 2,
						anim: 6
					});
				}
			});
			
			$.ajax({
				url: "http://127.0.0.1:8000/system_setting/data_overview_data/",
				type: "get",
				headers: {
					"Authorization": "JWT " + localStorage.getItem("cache_token")
				},
				dataType: "json",
				async: false,
				success: function(data) {
					data_overview_data = data.data
				},
				error: function(jqXHR) {
					layer.msg('数据加载错误，请联系管理员处理', {
						icon: 2,
						anim: 6
					});
				}
			});
			
			option = {
				tooltip: {
					trigger: 'axis',
					position: function(pt) {
						return [pt[0], '10%'];
					}
				},
				title: {
					left: 'center',
					text: '门禁流量图',
				},
				toolbox: {
					feature: {
						dataZoom: {
							yAxisIndex: 'none'
						},
						restore: {},
						saveAsImage: {}
					}
				},
				xAxis: {
					type: 'category',
					boundaryGap: false,
					data: data_overview_date
				},
				yAxis: {
					type: 'value',
					boundaryGap: [0, '100%']
				},
				dataZoom: [{
					type: 'inside',
					start: 80,
					end: 100
				}, {
					start: 0,
					end: 10,
					handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
					handleSize: '80%',
					handleStyle: {
						color: '#fff',
						shadowBlur: 3,
						shadowColor: 'rgba(0, 0, 0, 0.6)',
						shadowOffsetX: 2,
						shadowOffsetY: 2
					}
				}],
				series: [{
					name: '人次',
					type: 'line',
					smooth: true,
					symbol: 'none',
					sampling: 'average',
					itemStyle: {
						color: 'rgb(255, 70, 131)'
					},
					areaStyle: {
						color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							offset: 0,
							color: 'rgb(255, 158, 68)'
						}, {
							offset: 1,
							color: 'rgb(255, 70, 131)'
						}])
					},
					data: data_overview_data
				}]
			};

			// 使用刚指定的配置项和数据显示图表。
			myChart.setOption(option);
			
		</script>
	</body>

</html>